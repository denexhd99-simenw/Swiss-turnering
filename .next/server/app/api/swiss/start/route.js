"use strict";(()=>{var e={};e.id=173,e.ids=[173],e.modules={2509:e=>{e.exports=require("firebase-admin")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5395:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>w,originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>m});var r={};a.r(r),a.d(r,{POST:()=>c});var n=a(5419),i=a(9108),l=a(9678),s=a(3115);let o="SWISS";async function c(){let e=await s._.player.findMany({orderBy:{id:"asc"}});if(e.length<4)return new Response("Minimum 4 players required",{status:400});let t=function(e){let t=[...e];for(let e=t.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[a],t[a]=r}return t}(e);return await s._.$transaction(async e=>{await e.match.deleteMany(),await e.player.updateMany({data:{points:0,wins:0,losses:0}});for(let a=0;a<t.length;a+=2){let r=t[a],n=t[a+1];if(!n){await e.match.create({data:{phase:o,round:1,player1Id:r.id,player2Id:null,winnerId:r.id}}),await e.player.update({where:{id:r.id},data:{wins:{increment:1},points:{increment:3}}});continue}await e.match.create({data:{phase:o,round:1,player1Id:r.id,player2Id:n.id}})}}),Response.json({success:!0,message:"Swiss round 1 started"})}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/swiss/start/route",pathname:"/api/swiss/start",filename:"route",bundlePath:"app/api/swiss/start/route"},resolvedPagePath:"C:\\Users\\25simwek\\Downloads\\pingpong-turnering\\app\\api\\swiss\\start\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:y,headerHooks:w,staticGenerationBailout:m}=d,f="/api/swiss/start/route";function h(){return(0,l.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:p})}},3115:(e,t,a)=>{a.d(t,{_:()=>h});let r=a(2509),n=r.apps.length?r.apps[0]:function(){let e=function(){let e=process.env.FIREBASE_PROJECT_ID,t=process.env.FIREBASE_CLIENT_EMAIL,a=function(){let e=process.env.FIREBASE_PRIVATE_KEY;if(e)return e.replace(/\\n/g,"\n")}();if(e&&t&&a)return{projectId:e,clientEmail:t,privateKey:a}}();return e?r.initializeApp({credential:r.credential.cert(e)}):r.initializeApp({credential:r.credential.applicationDefault()})}(),i=r.firestore(n);async function l(e){let t=i.collection("__meta").doc("counters");return i.runTransaction(async a=>{let r=await a.get(t),n=Number(r.exists?r.data()?.[e]??0:0)+1;return a.set(t,{[e]:n},{merge:!0}),n})}async function s(){return(await i.collection("departments").get()).docs.map(e=>e.data())}async function o(){return(await i.collection("players").get()).docs.map(e=>e.data())}async function c(){return(await i.collection("matches").get()).docs.map(e=>e.data())}function d(e,t){return t?e.filter(e=>{for(let[a,r]of Object.entries(t)){let t=e[a];if(r&&"object"==typeof r&&!Array.isArray(r)){if(Object.prototype.hasOwnProperty.call(r,"not")&&t===r.not||Object.prototype.hasOwnProperty.call(r,"lt")&&!(t<r.lt)||Object.prototype.hasOwnProperty.call(r,"lte")&&!(t<=r.lte)||Object.prototype.hasOwnProperty.call(r,"gt")&&!(t>r.gt)||Object.prototype.hasOwnProperty.call(r,"gte")&&!(t>=r.gte)||Object.prototype.hasOwnProperty.call(r,"in")&&!(Array.isArray(r.in)?r.in:[]).includes(t))return!1}else if(t!==r)return!1}return!0}):e}function u(e,t){if(!t)return[...e];let a=Array.isArray(t)?t:[t];return[...e].sort((e,t)=>{for(let r of a){let a=Object.keys(r)[0],n="desc"===r[a]?-1:1,i=e[a],l=t[a];if(i!==l){if(null==i)return -1*n;if(null==l)return 1*n;if(i<l)return -1*n;if(i>l)return 1*n}}return 0})}function p(e,t){return"number"!=typeof t?e:e.slice(0,t)}function y(e,t){if(!t)return e;let a={};for(let[r,n]of Object.entries(t))n&&(a[r]=e[r]);return a}function w(e,t){let a={...e};for(let[e,r]of Object.entries(t)){if(r&&"object"==typeof r&&!Array.isArray(r)){if("number"==typeof r.increment){a[e]=Number(a[e]??0)+r.increment;continue}if("number"==typeof r.decrement){a[e]=Number(a[e]??0)-r.decrement;continue}}a[e]=r}return a}async function m(e){let t=await s(),a=new Map(t.map(e=>[e.id,e]));return e.map(e=>({...e,department:a.get(e.departmentId)??null}))}async function f(e,t){if(!t)return e;let a=await o(),r=new Map(a.map(e=>[e.id,e]));return e.map(e=>({...e,player1:t.player1?e.player1Id?r.get(e.player1Id)??null:null:void 0,player2:t.player2?e.player2Id?r.get(e.player2Id)??null:null:void 0,winner:t.winner?e.winnerId?r.get(e.winnerId)??null:null:void 0}))}let h={player:{async findMany(e={}){let t=await o(),a=t=p(t=u(t=d(t,e.where),e.orderBy),e.take);return e.include?.department&&(a=await m(a)),e.select&&(a=a.map(t=>y(t,e.select))),a},async create(e){let t=await l("players"),a=e.data??{},r={id:t,name:a.name,points:a.points??0,wins:a.wins??0,losses:a.losses??0,departmentId:Number(a.departmentId)};return await i.collection("players").doc(String(t)).set(r),r},async delete(e){let t=Number(e.where?.id);return await i.collection("players").doc(String(t)).delete(),{id:t}},async update(e){let t=Number(e.where?.id),a=i.collection("players").doc(String(t)),r=await a.get();if(!r.exists)throw Error("Player not found");let n=w(r.data(),e.data??{});return await a.set(n),n},async updateMany(e){let t=d(await o(),e.where),a=0;for(let r of t){let t=w(r,e.data??{});await i.collection("players").doc(String(r.id)).set(t),a+=1}return{count:a}}},department:{async findMany(e={}){let t=await s();return(t=p(t=u(t=d(t,e.where),e.orderBy),e.take),e.select)?t.map(t=>y(t,e.select)):t},async findUnique(e){let t=Number(e.where?.id),a=await i.collection("departments").doc(String(t)).get();return a.exists?a.data():null},async create(e){let t=await l("departments"),a={id:t,name:e.data?.name};return await i.collection("departments").doc(String(t)).set(a),a},async delete(e){let t=Number(e.where?.id);return await i.collection("departments").doc(String(t)).delete(),{id:t}}},match:{async findMany(e={}){let t=await c(),a=t=p(t=u(t=d(t,e.where),e.orderBy),e.take);return e.include&&(a=await f(a,e.include)),e.select&&(a=a.map(t=>y(t,e.select))),a},async findUnique(e){let t=Number(e.where?.id),a=await i.collection("matches").doc(String(t)).get();if(!a.exists)return null;let r=a.data();return e.include?(await f([r],e.include))[0]:r},async findFirst(e={}){return(await this.findMany(e))[0]??null},count:async(e={})=>d(await c(),e.where).length,async aggregate(e={}){let t=d(await c(),e.where);return e._max?.round?{_max:{round:t.length?Math.max(...t.map(e=>Number(e.round??0))):null}}:{_max:{}}},async create(e){let t=await l("matches"),a=e.data??{},r={id:t,round:Number(a.round??1),phase:a.phase??"SWISS",player1Id:a.player1Id??null,player2Id:a.player2Id??null,winnerId:a.winnerId??null,createdAt:a.createdAt??new Date().toISOString()};return await i.collection("matches").doc(String(t)).set(r),r},async createMany(e){let t=Array.isArray(e.data)?e.data:[],a=0;for(let e of t)await this.create({data:e}),a+=1;return{count:a}},async update(e){let t=Number(e.where?.id),a=i.collection("matches").doc(String(t)),r=await a.get();if(!r.exists)throw Error("Match not found");let n=w(r.data(),e.data??{});return await a.set(n),n},async delete(e){let t=Number(e.where?.id);return await i.collection("matches").doc(String(t)).delete(),{id:t}},async deleteMany(e={}){let t=d(await c(),e.where),a=0;for(let e of t)await i.collection("matches").doc(String(e.id)).delete(),a+=1;return{count:a}}},$transaction:async e=>e(h)}},5419:(e,t,a)=>{e.exports=a(517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638],()=>a(5395));module.exports=r})();