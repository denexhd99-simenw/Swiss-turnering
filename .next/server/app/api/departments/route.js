"use strict";(()=>{var e={};e.id=384,e.ids=[384],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9005:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>g});var n={};r.r(n),r.d(n,{DELETE:()=>u,GET:()=>d,POST:()=>p});var a=r(5419),s=r(9108),i=r(9678),o=r(8093);async function d(){return Response.json(await o._.department.findMany())}async function p(e){let t=await e.json();if(!t.name)return new Response("Missing name",{status:400});let r=await o._.department.create({data:{name:t.name}});return Response.json(r)}async function u(e){let t=await e.json(),r=Number(t.departmentId);if(!Number.isInteger(r))return new Response("Missing departmentId",{status:400});if(!await o._.department.findUnique({where:{id:r}}))return new Response("Department not found",{status:404});let n=await o._.player.findMany({where:{departmentId:r},select:{id:!0,name:!0}});if(0===n.length)return await o._.department.delete({where:{id:r}}),Response.json({success:!0});let a=Array.isArray(t.reassignments)?t.reassignments:[],s=new Map;for(let e of a){let t=Number(e.playerId),r=Number(e.departmentId);Number.isInteger(t)&&Number.isInteger(r)&&s.set(t,r)}if(n.some(e=>!s.has(e.id)))return Response.json({error:"All players must be reassigned before deletion"},{status:400});let i=Array.from(new Set(Array.from(s.values())));if(i.some(e=>e===r))return Response.json({error:"Cannot reassign to the department being deleted"},{status:400});let d=await o._.department.findMany({where:{id:{in:i}},select:{id:!0}}),p=new Set(d.map(e=>e.id));return i.some(e=>!p.has(e))?Response.json({error:"One or more target departments do not exist"},{status:400}):(await o._.$transaction(async e=>{for(let t of n)await e.player.update({where:{id:t.id},data:{departmentId:s.get(t.id)}});await e.department.delete({where:{id:r}})}),Response.json({success:!0}))}let m=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/departments/route",pathname:"/api/departments",filename:"route",bundlePath:"app/api/departments/route"},resolvedPagePath:"C:\\Users\\25simwek\\Downloads\\pingpong-turnering\\app\\api\\departments\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:w,headerHooks:f,staticGenerationBailout:g}=m,h="/api/departments/route";function y(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:c})}},8093:(e,t,r)=>{r.d(t,{_:()=>a});let n=require("@prisma/client"),a=global.prisma||new n.PrismaClient},5419:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638],()=>r(9005));module.exports=n})();